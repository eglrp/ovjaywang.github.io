<!DOCTYPE HTML>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
  
    <title>后方交会检校(3)--角度、坐标及其应用 | ov智商捉急</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=3,minimum-scale=1">
    
    <meta name="author" content="Jay Wang">
    
    <meta name="description" content="本片涉及前文中叙述到的三个角元素含义及外延，包含与角元素相关的旋转矩阵R并简明介绍几个常用坐标系。
内容提要：
几个概念（视场 像场 视场角）&amp;nbsp;
几个坐标系
共线方程的推导
&amp;nbsp;坐标旋转即共线方程的应用
坐标旋转
像片水平与倾斜像点坐标的关系
几个概念：&amp;nbsp;视场：光线通过物">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/touxiang.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/touxiang.jpg">
    
    <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head></html>
  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/xiaozaizi.png" alt="ov智商捉急" title="ov智商捉急"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ov智商捉急">ov智商捉急</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">dooby.me</a></li>
					
						<li><a href="/me">关于我</a></li>
					
						<li><a href="/archives">归档</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search">
						<input type="hidden" name="q" value="site:ovjaywang.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/28/后方交会检校(3)--角度、坐标及其应用/" title="后方交会检校(3)--角度、坐标及其应用" itemprop="url">后方交会检校(3)--角度、坐标及其应用</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://ovjaywang.github.io" title="Jay Wang">Jay Wang</a>
    </p>
  <p class="article-time">
    <time datetime="2015-10-28T11:55:49.000Z" itemprop="datePublished">2015-10-28</time>
    Updated:<time datetime="2016-04-11T14:09:45.581Z" itemprop="dateModified">2016-04-11</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
		</div>
		
		<p>本片涉及前文中叙述到的三个角元素含义及外延，包含与角元素相关的旋转矩阵R并简明介绍几个常用坐标系。</p>
<p>内容提要：</p>
<p><a href="#几个概念：">几个概念</a>（视场 像场 视场角）&nbsp;</p>
<p><a href="#几个坐标系">几个坐标系</a></p>
<p><a href="#共线方程的推导">共线方程的推导</a></p>
<p>&nbsp;<a href="#坐标旋转即共线方程的应用">坐标旋转即共线方程的应用</a></p>
<p><a href="#坐标旋转">坐标旋转</a></p>
<p><a href="#像片水平与倾斜像点坐标的关系">像片水平与倾斜像点坐标的关系</a></p>
<font size="5"><strong><a name="几个概念：">几个概念：</a></strong></font>&nbsp;<br><br>视场：光线通过物镜后，焦面上照度不均匀的光亮圆为镜头的视场。<br><br>像场：摄影时，影像相当清晰的一部分视场内的光亮圆。<br><br>视场角（filed of view）：由镜头后节点向市场边缘射出的光线所张开的角，用2β表示。常角&lt;75&deg;，宽角75&deg;~100&deg;，特宽角&gt;100&deg;<br><br><img src="http://www.dooby.me/wp-content/uploads/2015/11/E31B0C36B248ADD81D8147EE808E68085B42914E.jpg" alt=""><br><br>数码相机的瞬时视场角IFOV与空间分辨率的关系：$$R_{g}=2\sqrt{2}IFOV$$<br><br><font size="5"><strong><a name="几个坐标系">几个坐标系：</a></strong></font>

<font color="#FF0000">像素坐标系</font>-2D-IAJ以像片左上角为坐标原点，下为y正，右为x正。坐标一般用(u,v)表示。<br><br>$$x=J\Delta -x<em>{0}$$,$$y=-(I\Delta -y</em>{0})$$<br><br><img src="http://www.dooby.me/wp-content/uploads/2015/11/6E6CFB3A2924474655DD2222F8223CABE46AD6FC.jpg" alt=""><br><br>这里，值得一提的是，坐标单位一般是像素。而一般以中心为基准的坐标系（像平面坐标系，一般用(x,y)表示的单位是毫米。这两个坐标系之间的转换公式形式可以写为:<br><br>$$!\left{\begin{matrix}u=\frac{x}{d<em>{x}}+u</em>{0}=x<em>s<em>{x+u</em>{0}}\v=\frac{y}{d<em>{y}}+v</em>{0}=y</em>s<em>{y}+v</em>{0}\end{matrix}\right.$$<br><br>这里，dx dy分别代表每个像素在横轴x和纵轴y的物理尺寸，单位是mm per pixel。而sx和sy分别是二者的导数。或可以用矩阵的形式：<br><br>$$!\begin{pmatrix}u\v\1\end{pmatrix}=\begin{pmatrix}s<em>{x}&amp;0&amp;c</em>{x}\0&amp;s<em>{y}&amp;c</em>{y}\0&amp;0&amp;1\end{pmatrix}\begin{pmatrix}x\y\1\end{pmatrix}$$<br><br><font color="#FF0000">像空间坐标系</font>-3D-Sxyz表示<font color="#FF0000">像点</font>在<font color="#FF0000">像方空间</font>位置的空间直角坐标系。原点即投影中心，xy轴分别平行于像平面xy轴，z轴即主光轴的方向。在该坐标系中，所有像点的z坐标都是-f。几何含义就是，投影中心在投向焦平面的时候，与设计上认为的像点（像平面几何中心）相比，投偏了多少。像平面坐标+内方位元素就可以定位所有穿过像平面到达物放世界的光束的形状；该坐标系的方位就代表了像片的空间方位，像空间坐标系绕原点的旋转就代表了像片绕投影中心的旋转。下图中S为投影中心，O为投影中心，a为任意一个像点，其坐标为(x,y,-f)<br><br><img src="http://www.dooby.me/wp-content/uploads/2015/11/B91663ACDA13BB74808431E1CBA1F9DEB72AAA10.jpg" alt=""><br><br><font color="#FF0000">物方空间坐标系</font>-3D-O-XdYdZd测绘系统选择一定的原点，进行测绘测量的世界真实坐标，描述点的空间位置。摄影测量的成果最终要转到该坐标系中。<br><br>地面辅助坐标系-3D-O-XtYtZt 一般称地辅系，<font color="#FF0000">Z轴铅锤，X Y轴与物空系平行</font>。在摄影测量中，<font color="#FF0000">原点都默认设为摄影中心S</font>。因此该坐标系<font color="#FF0000">与物空系不需要进行旋转，只需要平移</font>，即坐标轴加减运算。这是中间成果和数学运算常用的坐标系。下图是地辅系、像空系、像平面坐标系在一起的示意图。而共线方程就是依据这几个坐标系空间转换得到的。原理为三角形相似。<br><br><img src="http://www.dooby.me/wp-content/uploads/2015/11/13598A8CB4E7FDBD56C5B595E2AD0624D9A2FD14.jpg" alt=""><br><br><font color="#FF0000">像素坐标系→像平面坐标系（内方位元素）</font>

<font color="#FF0000">地面辅助坐标系→像平面坐标系（外方位元素）</font>

<p>共线方程的物理含义就是三点一线，两点一系（理想状况下，摄影瞬间像点、投影中心位于同一直线。）如图所示：</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/1AF795ADEC60BCB2F0396B5F841F4844E636A283.jpg" alt=""></p>
<p>图中浅蓝色坐标系是<font color="#00FFFF"><u>地辅系</u></font>（这里 地辅系通过投影中心 连接物空系和像空系），a点是像平面上的投影，A点是地面控制点，红色坐标系是<font color="#FF0000"><u>物方空间坐标系</u></font>，黄色坐标是<font color="#FFC800"><u>像空系</u></font>（像空系垂直与像平面），λ即投影比例尺，二维坐标各自成比例，形成了共线方程的最基本形式。也可以用向量的方式来解释。其中Xs &nbsp;Ys&nbsp; Zs是投影中心在物方空间的坐标，$$X<em>{A}&nbsp; Y</em>{A}&nbsp; Z_{A}$$是真实世界某控制点的物方坐标。两者相减，即得到相对位置，即地辅系的坐标。该方程是<font color="#FF0000"><strong>建立在地辅系上</strong></font>的。</p>
<p><strong><a name="共线方程的推导">共线方程的推导</a></strong></p>
<p>→<strong>点的坐标变换</strong>（一点两系）：目标是建立同一个点在空间坐标系与地面辅助坐标系中坐标值之间的对应关系。坐标点一般的转换关系为：</p>
<p>$$!\begin{pmatrix}X\Y\Z\end{pmatrix}=R\begin{pmatrix}x\y\z\end{pmatrix}$$</p>
<p>$$!\begin{pmatrix}x\y\z\end{pmatrix}=R^{T}\begin{pmatrix}X\Y\Z\end{pmatrix}$$</p>
<p>则R称为旋转矩阵。</p>
<p>点a、A位于两个坐标系，分别用两组坐标来表示。S-xyz示意像空系，S-XYZ示意地辅系。</p>
<table width="80%" border="0"> <tbody> <tr> <td width="26%">点\坐标系</td> <td width="26%">S-xyz</td> <td width="26%">S-XYZ</td> </tr> <tr> <td width="26%">a</td> <td width="26%">x,y,-f</td> <td width="26%">Xa，Ya，Za</td> </tr> <tr> <td width="26%">A</td> <td width="26%">xA,yA,zA</td> <td width="26%">X,Y,Z</td> </tr> </tbody> </table>

<p>由于旋转矩阵相同，两个点可表示为：</p>
<p>$$!\begin{pmatrix}X\Y\Z\end{pmatrix}=R\begin{pmatrix}x<em>{A}\y</em>{A}\z_{A}\end{pmatrix}$$</p>
<p>$$!\begin{pmatrix}X<em>{a}\Y</em>{a}\Z_{a}\end{pmatrix}=R\begin{pmatrix}x\y\-f\end{pmatrix}$$</p>
<p>则，$$!\begin{pmatrix}x<em>{A}\y</em>{A}\z_{A}\end{pmatrix}=R^{T}\begin{pmatrix}X\Y\Z\end{pmatrix}$$</p>
<p>→点的共线关系（两点一系）：目标是建立像点和物方点的坐标关系。易知，两点一线时，可以用一个点的齐次方程表示另一个点。即：</p>
<p>$$!\left{\begin{matrix}x<em>{A}=a</em>{1}X+b<em>{1}Y+c</em>{1}Z\y<em>{A}=a</em>{2}X+b<em>{2}Y+c</em>{2}Z\y<em>{A}=a</em>{3}X+b<em>{3}Y+c</em>{3}Z\end{matrix}\right.$$</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/7238D8A7EF534575B5EE48B9CCA41FF8E4903B6C.jpg" alt=""></p>
<p>上图中可建立的方程有，（该方程建立在像空系中）</p>
<p>$$!\frac{x<em>{A}}{x}=\frac{y</em>{A}}{y}=\frac{z<em>{A}}{-f}=\lambda \Rightarrow\left{\begin{matrix}x=-f\frac{x</em>{A}}{z<em>{A}}\y=-f\frac{y</em>{A}}{z_{A}}\end{matrix}\right.$$</p>
<p>联立坐标转换方程和像空系方程，化简即可得到传说中的共线条件方程。</p>
<p>用<font color="#FF0000">地面点</font>坐标表示<font color="#FF0000">像点</font>坐标的共线方程（地辅系形式）</p>
<p>$$!x=-f\frac{a<em>{1}(X</em>{T}-X<em>{S})+b</em>{1}(Y<em>{T}-Y</em>{S})+c<em>{1}(Z</em>{T}-Z<em>{S})}{a</em>{3}(X<em>{T}-X</em>{S})+b<em>{3}(Y</em>{T}-Y<em>{S})+c</em>{3}(Z<em>{T}-Z</em>{S})}$$</p>
<p>$$!y=-f\frac{a<em>{2}(X</em>{T}-X<em>{S})+b</em>{2}(Y<em>{T}-Y</em>{S})+c<em>{2}(Z</em>{T}-Z<em>{S})}{a</em>{3}(X<em>{T}-X</em>{S})+b<em>{3}(Y</em>{T}-Y<em>{S})+c</em>{3}(Z<em>{T}-Z</em>{S})}$$</p>
<p>或（物空系形式）</p>
<p>$$!x=-f\frac{a<em>{1}(X-X</em>{S})+b<em>{1}(Y-Y</em>{S})+c<em>{1}(Z-Z</em>{S})}{a<em>{3}(X-X</em>{S})+b<em>{3}(Y-Y</em>{S})+c<em>{3}(Z-Z</em>{S})}$$</p>
<p>$$!y=-f\frac{a<em>{2}(X-X</em>{S})+b<em>{2}(Y-Y</em>{S})+c<em>{2}(Z-Z</em>{S})}{a<em>{3}(X-X</em>{S})+b<em>{3}(Y-Y</em>{S})+c<em>{3}(Z-Z</em>{S})}$$</p>
<p>同理，利用蓝图中在地辅系的共线方程，可以建立用<font color="#FF0000">像点</font>坐标表达<font color="#FF0000">地面坐标</font>的方程（物空系形式）</p>
<p>$$!X=X<em>{s}+(Z-Z</em>{s})\frac{a<em>{1}x+a</em>{2}y-a<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>$$!Y=Y<em>{s}+(Z-Z</em>{s})\frac{b<em>{1}x+b</em>{2}y-b<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>上式也成为了前方交会解算的基本方程。</p>
<hr>
<p><strong><a name="坐标旋转即共线方程的应用">坐标旋转即共线方程的应用</a></strong></p>
<p>①<strong>求像点坐标</strong></p>
<ul>
<li>已知Xs Ys Zs ai bi ci f(物方真值 旋转矩阵)</li>
<li>求x y（像平面坐标）</li>
</ul>
<p>依赖方程：</p>
<p>$$!x=-f\frac{a<em>{1}(X-X</em>{S})+b<em>{1}(Y-Y</em>{S})+c<em>{1}(Z-Z</em>{S})}{a<em>{3}(X-X</em>{S})+b<em>{3}(Y-Y</em>{S})+c<em>{3}(Z-Z</em>{S})}$$</p>
<p>$$!y=-f\frac{a<em>{2}(X-X</em>{S})+b<em>{2}(Y-Y</em>{S})+c<em>{2}(Z-Z</em>{S})}{a<em>{3}(X-X</em>{S})+b<em>{3}(Y-Y</em>{S})+c<em>{3}(Z-Z</em>{S})}$$</p>
<p>②<strong>答解外方位元素</strong>(后方交会基本原理)</p>
<ul>
<li>已知$$x<em>{i}^{‘} y</em>{i}^{‘} X<em>{i} Y</em>{i} Z<em>{i} x</em>{0} y_{0} f$$（像坐标观测值 物方观测值 内方位元素）</li>
<li>求Xs Ys Zs ai bi ci（外方位元素）</li>
</ul>
<p>依赖方程：</p>
<p>$$!x^{‘}-x<em>{0}=-f\frac{a</em>{1}(X-X<em>{S})+b</em>{1}(Y-Y<em>{S})+c</em>{1}(Z-Z<em>{S})}{a</em>{3}(X-X<em>{S})+b</em>{3}(Y-Y<em>{S})+c</em>{3}(Z-Z_{S})}$$</p>
<p>$$!y^{‘}-y<em>{0}=-f\frac{a</em>{2}(X-X<em>{S})+b</em>{2}(Y-Y<em>{S})+c</em>{2}(Z-Z<em>{S})}{a</em>{3}(X-X<em>{S})+b</em>{3}(Y-Y<em>{S})+c</em>{3}(Z-Z_{S})}$$</p>
<p>③<strong>求地面点坐标</strong></p>
<ul>
<li>已知x，y，Xs，Ys，Zs，ai，bi，ci，f(外方位元素，像点坐标观测值，焦距)</li>
<li>求X，Y，Z（求未知物方点坐标,这里，大部分都知道DEM，即(X,Y)坐标下的Z高程的信息）</li>
</ul>
<p>依赖方程(单片定位)：</p>
<p>$$!\frac{X-X<em>{S}}{Z-Z</em>{S}}=\frac{a<em>{1}x+a</em>{2}y-a<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>$$!\frac{Y-Y<em>{S}}{Z-Z</em>{S}}=\frac{b<em>{1}x+b</em>{2}y-b<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>依赖方程（立体像对定位）–4个方程解算3个未知数。(前方交会后方交会同时进行)</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/5F3074FF98FA07ED1F357962C68FF593E047311B.jpg" alt=""></p>
<p>$$!\frac{X-X<em>{S}}{Z-Z</em>{S}}=\frac{a<em>{1}x+a</em>{2}y-a<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>$$!\frac{Y-Y<em>{S}}{Z-Z</em>{S}}=\frac{b<em>{1}x+b</em>{2}y-b<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>$$!\frac{X-X<em>{S}^{‘}}{Z-Z</em>{S}^{‘}}=\frac{a<em>{1}^{‘}x^{‘}+a</em>{2}^{‘}y^{‘}-a<em>{3}^{‘}f}{c</em>{1}^{‘}x^{‘}+c<em>{2}^{‘}y^{‘}-c</em>{3}^{‘}f}$$</p>
<p>$$!\frac{Y-Y<em>{S}^{‘}}{Z-Z</em>{S}^{‘}}=\frac{b<em>{1}^{‘}x^{‘}+b</em>{2}^{‘}y^{‘}-b<em>{3}^{‘}f}{c</em>{1}^{‘}x^{‘}+c<em>{2}^{‘}y^{‘}-c</em>{3}^{‘}f}$$</p>
<hr>
<p><a name="坐标旋转">坐标旋转</a></p>
<p>从物方空间坐标系到像空间坐标系的转换其实就是一个<font color="#FF0000">平移</font>（平移到地辅系）再<font color="#FF0000">旋转</font>的过程，这就是常见的[R|t]。旋转真正的含义就是对3个坐标轴作二维角度上的旋转，3个旋转合成一个旋转矩阵R。坐标轴旋转θ角度，等同于目标点绕坐标原点反方向旋转同样的角度θ。选择的旋转3个坐标系的方式有很多，常用的就是以Y轴为主轴的φ，ω,k的系统。</p>
<p><strong>航向倾角φ</strong>（pitching）：z轴在<font color="#FF0000">XZ坐标面内的投影</font>（即过z轴所做的XZ面的垂面与XZ面的交线）<font color="#FF0000">与Z轴的夹角</font>，叫做航向倾角。从Z轴算起，由Y轴的负方向逆时针为正。如图为正。</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/98B5D21FDF0802661E47A2C3089CF683E856F014.jpg" alt=""></p>
<p><strong>旁向倾角ω</strong>（roll）：z轴与XZ坐标面之间的夹角，即z轴与它在XZ面上投影之间的夹角，叫做旁向倾角。从z轴的投影算起，由X轴的正方向看逆时针为正。如图为正。</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/5A4A8734E57C7C288466AFAF21FE3D1DA7F17C1B.jpg" alt=""></p>
<p><strong>像片旋角k</strong>（yaw）：Y轴在xy坐标系面上的投影与y轴的夹角，叫做旋角。从投影算起，由z轴正方向看逆时针为正。如图k为正。</p>
<ul>
<li>二维平面的坐标旋转</li>
</ul>
<p>如图所示，旋转是可逆变化，两套坐标之间可以用矩阵和逆矩阵进行转换。</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/9C02C1C63C5D098E97E8A04FBBDFB60F02221B34.jpg" alt=""></p>
<p>$$!\begin{bmatrix}x^{‘}\y^{‘}\end{bmatrix}=A\begin{bmatrix}x\y\end{bmatrix},\begin{bmatrix}x\y\end{bmatrix}=A^{-1}\begin{bmatrix}x^{‘}\y^{‘}\end{bmatrix}$$</p>
<p>$$!A=\begin{bmatrix}a<em>{1}&amp;a</em>{2}\b<em>{1}&amp;b</em>{2}\end{bmatrix}=\begin{bmatrix}cos \widehat{x^{‘}x}&amp;cos \widehat{x^{‘}y}\cos\widehat{y^{‘}x}&amp;cos \widehat{y^{‘}y}\end{bmatrix}=\begin{bmatrix}cos \kappa&amp;sin \kappa\-sin \kappa&amp;cos\kappa\end{bmatrix}$$</p>
<p>式中</p>
<p>a1是x’轴与x轴夹角的余弦；a1=cos k</p>
<p>b1是x’轴与y轴夹角的余弦：b1=cos(90&deg;-k)=sin k</p>
<p>a2是y’轴与x轴夹角的余弦：a2=cos(90&deg;+k)=-sin k</p>
<p>b2是y’轴与y轴夹角的余弦：b2=cos k</p>
<ul>
<li>三维空间的坐标旋转</li>
</ul>
<p>从像空间直角坐标系到像空间辅助坐标系之间的转换可以通过<font color="#FF0000">三次二维坐标转换完成</font>。</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/A203A33F40A9904D7EA2D966CB486C277511405E.jpg" alt=""></p>
<p>$$!\begin{bmatrix}X\Y\Z\end{bmatrix}=R\begin{bmatrix}x\y\-f\end{bmatrix}$$</p>
<p>$$!R=\begin{bmatrix}a<em>{1}&amp;a</em>{2}&amp;a<em>{3}\b</em>{1}&amp;b<em>{2}&amp;b</em>{3}\c<em>{1}&amp;c</em>{2}&amp;c_{3}\end{bmatrix}=\begin{bmatrix}cos\widehat{Xx}&amp;cos\widehat{Xy}&amp;cos\widehat{Xz}\cos\widehat{Yx}&amp;cos\widehat{Yy}&amp;cos\widehat{Yz}\cos\widehat{Zx}&amp;cos\widehat{Zy}&amp;cos\widehat{Zz}\end{bmatrix}$$</p>
<p>①S-XYZ<font color="#FF0000">绕Y轴旋转φ</font>到S-XφYφZφ，在XSZ平面内，以S点位圆心旋转XSZ至XφSZφ</p>
<p>$$!\begin{bmatrix}X\Y\Z\end{bmatrix}=R<em>{\varphi}\begin{bmatrix}X</em>{\varphi }\Y<em>{\varphi }\Z</em>{\varphi }\end{bmatrix}=\begin{bmatrix}cos\varphi&amp;0&amp;-sin\varphi\0&amp;1&amp;0\sin\varphi&amp;0&amp;cos\varphi\end{bmatrix}\begin{bmatrix}X<em>{\varphi }\Y</em>{\varphi }\Z_{\varphi }\end{bmatrix}$$</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/6F2D6EC82C1793253C32825B3180B3F84A68D11B.jpg" alt=""></p>
<p>该次变换中，由于是绕Y轴旋转的，因此Y坐标值没有改变，相当于在二维XSZ平面做了旋转，下同。</p>
<p>②S-XφYφZφ绕Xφ旋转ω角到S-XφωYφωZφω，在YφSZφ平面内，以S点为圆心旋转YφSZφ到YφωSZφω。这次变化中，x轴坐标值没有改变。</p>
<p>$$!\begin{bmatrix}X<em>{\varphi}\Y</em>{\varphi}\Z<em>{\varphi}\end{bmatrix}=R</em>{\omega}\begin{bmatrix}X<em>{\varphi\omega}\Y</em>{\varphi \omega}\Z<em>{\varphi\omega}\end{bmatrix}=\begin{bmatrix}1&amp;0&amp;0\0&amp;cos \omega&amp;-sin \omega\0&amp;sin \omega&amp;cos \omega \end{bmatrix}\begin{bmatrix}X</em>{\varphi\omega}\Y<em>{\varphi \omega}\Z</em>{\varphi\omega}\end{bmatrix}$$</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/3669611136A21AC23885E7932C6D17D84AEC1C27.jpg" alt=""></p>
<p>③S-XφωYφωZφω绕Zφω轴旋转k角度到S-xyz，在XφSYω平面内，以S点为圆心转到XφωSYφω至xSy。</p>
<p>$$!\begin{bmatrix}X<em>{\varphi\omega}\Y</em>{\varphi\omega}\Z<em>{\varphi\omega}\end{bmatrix}=R</em>{\kappa}\begin{bmatrix}x\y\-f\end{bmatrix}=\begin{bmatrix}cos \kappa&amp;-sin \kappa&amp;0\sin \kappa&amp;cos \kappa&amp;0\0&amp;0&amp;1\end{bmatrix}\begin{bmatrix}x\y\-f\end{bmatrix}$$</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/3C453D9DA7CF479D4624D8465171F8FAF1F9E701.jpg" alt=""></p>
<p>联立之前三个旋转矩阵即可得到三维下的旋转矩阵R</p>
<p>$$!\begin{bmatrix}X\Y\Z\end{bmatrix}=R<em>{\varphi}R</em>{\omega}R<em>{\kappa}\begin{bmatrix}x\y\-f\end{bmatrix}=\begin{bmatrix}cos\varphi&amp;0&amp;-sin\varphi\0&amp;1&amp;0\sin\varphi&amp;0&amp;cos\varphi\end{bmatrix}\begin{bmatrix}1&amp;0&amp;0\0&amp;cos \omega&amp;-sin \omega\0&amp;sin \omega&amp;cos \omega \end{bmatrix}\begin{bmatrix}cos \kappa&amp;-sin \kappa&amp;0\sin \kappa&amp;cos \kappa&amp;0\0&amp;0&amp;1\end{bmatrix}\begin{bmatrix}x\y\-f\end{bmatrix}=\begin{bmatrix}a</em>{1}&amp;a<em>{2}&amp;a</em>{3}\b<em>{1}&amp;b</em>{2}&amp;b<em>{3}\c</em>{1}&amp;c<em>{2}&amp;c</em>{3} \end{bmatrix}\begin{bmatrix}x\y\-f\end{bmatrix}=R\begin{bmatrix}x\y\-f\end{bmatrix}$$</p>
<p>旋转矩阵R因此由外方位元素φ，ω，k确定。其中a1,a2,a3,b1,b2,b3,c1,c2,c3是9个方向的<font color="#FF0000">方向余弦</font>。</p>
<p>$$!a_{1}=cos\varphi cos\kappa-sin\varphi sin\omega sin\kappa$$</p>
<p>$$!a_{2}=-cos\varphi sin\kappa -sin\varphi sin\omega cos\kappa$$</p>
<p>$$!a_{3}=-sin\varphi cos\omega$$</p>
<p>$$!b_{1}=cos\omega sin\kappa$$</p>
<p>$$!b_{2}=cos\omega cos\kappa$$</p>
<p>$$!b_{3}=-sin\omega$$</p>
<p>$$!c_{1}=sin\varphi cos\kappa+cos\varphi sin\omega sin\kappa $$</p>
<p>$$!c_{2}=-sin\varphi sin\kappa +cos\varphi sin\omega cos\kappa $$</p>
<p>$$!c_{3}=cos\varphi cos\omega $$</p>
<p>通过解算可知</p>
<p>$$!R\cdot R^{T}=\begin{bmatrix}a<em>{1}&amp;a</em>{2}&amp;a<em>{3}\b</em>{1}&amp;b<em>{2}&amp;b</em>{3}\c<em>{1}&amp;c</em>{2}&amp;c<em>{3} \end{bmatrix}\cdot \begin{bmatrix}a</em>{1}&amp;b<em>{1}&amp;c</em>{1}\a<em>{2}&amp;b</em>{2}&amp;c<em>{2}\a</em>{3}&amp;b<em>{3}&amp;c</em>{3}\end{bmatrix}=\begin{bmatrix}1&amp;0&amp;0\0&amp;1&amp;0\0&amp;0&amp;1\end{bmatrix}$$</p>
<p>$$!R^{T}\cdot R =\begin{bmatrix}a<em>{1}&amp;b</em>{1}&amp;c<em>{1}\a</em>{2}&amp;b<em>{2}&amp;c</em>{2}\a<em>{3}&amp;b</em>{3}&amp;c<em>{3}\end{bmatrix}\cdot \begin{bmatrix}a</em>{1}&amp;a<em>{2}&amp;a</em>{3}\b<em>{1}&amp;b</em>{2}&amp;b<em>{3}\c</em>{1}&amp;c<em>{2}&amp;c</em>{3} \end{bmatrix}=\begin{bmatrix}1&amp;0&amp;0\0&amp;1&amp;0\0&amp;0&amp;1\end{bmatrix}$$</p>
<p>很明显，意味着R与$$R^{T}$$互为逆矩阵。这也验证了R矩阵是两个坐标系之间相互转换的矩阵。由$$RR^{T}=I$$可得：</p>
<p>（1）同行（列）列的各元素自乘之和为1</p>
<p>（2）任意两行（列）的对应元素相乘之和为0（正交）</p>
<p>（3）旋转矩阵行列式为|R|=1</p>
<p>（4）每行元素等于其代数余子式</p>
<p>（5）每个元素为变换前后坐标轴夹角的余弦值<br> 易知</p>
<p>$$!\varphi =-arctan(\frac{a<em>{3}}{c</em>{3}}),\omega =-arcsin(b<em>{3}),\kappa =-arctan(\frac{b</em>{1}}{b_{2}})$$</p>
<p>$$!a<em>{1}^{2}+a</em>{2}^{2}+a<em>{3}^{2}=1,b</em>{1}^{2}+b<em>{2}^{2}+b</em>{3}^{2}=1,c<em>{1}^{2}+c</em>{2}^{2}+c_{3}^{2}=1$$</p>
<p>$$!a<em>{1}b</em>{1}+a<em>{2}b</em>{2}+a<em>{3}b</em>{3}=0,a<em>{1}c</em>{1}+a<em>{2}c</em>{2}+a<em>{3}c</em>{3}=0,b<em>{1}c</em>{1}+b<em>{2}c</em>{2}+b<em>{3}c</em>{3}=0$$</p>
<p>$$!a<em>{1}^{2}+b</em>{1}^{2}+c<em>{1}^{2}=1,a</em>{2}^{2}+b<em>{2}^{2}+c</em>{2}^{2}=1,a<em>{3}^{2}+b</em>{3}^{2}+c_{3}^{2}=1$$</p>
<p>$$!a<em>{1}a</em>{2}+b<em>{1}b</em>{2}+c<em>{1}c</em>{2}=0,a<em>{1}a</em>{3}+b<em>{1}b</em>{3}+c<em>{1}c</em>{3}=0,a<em>{2}a</em>{3}+b<em>{2}b</em>{3}+c<em>{2}c</em>{3}=0$$</p>
<font size="+0"><strong><a name="像片水平与倾斜像点坐标的关系">像片水平与倾斜像点坐标的关系</a></strong></font>。（这里，以摄影中心<font color="#FF0000">S点为像片旋转中心</font>，因此外方位元素中，<font color="#FF0000">主距依旧是f</font>，<font color="#FF0000">线元素没有改变</font>）<br><br>已知：外方位元素Xs Ys Zs φ ω k(即九个方向余弦)<br><br><font color="#FF0000">对于某高程</font>，摄影中心在该高程Z方向的投影N坐标为(Xs,Ys,Zs-$$H_{N}$$)–<font color="#FF0000">物方坐标系</font>

<p><font color="#FF0000">对于某高程</font>，摄影中心在该高程的垂线与像平面的交点n坐标为$$(-f\frac{c<em>{1}}{c</em>{3}},-f\frac{c<em>{2}}{c</em>{3}})$$–<font color="#FF0000">像方坐标</font>，可将上点带入共线条件方程后方交会求得↓↓↓</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/A1BBA5EFFED4F68C01CF47FBC61FC4FA7087739E.jpg" alt=""></p>
<p>又根据共线方程前方交会公式，在水平图像的平面上，物方任意点A(X,Y,Z)-（物方坐标）在像平面的成像点a为$$(x^{0},y^{0})$$-（像平面坐标）或$$(x^{0},y^{0},-f)$$像空间坐标系。↓↓↓</p>
<p><img src="http://www.dooby.me/wp-content/uploads/2015/11/3C7C83AD827FB7A7BD4108090804ED13131E82D7.jpg" alt=""></p>
<p>值得注意的是，主光轴正好是垂直于大地水平面，所以，地辅系与像空系只需要在XSY平面上旋转即可。</p>
<p>在倾斜形态中，由像点表示物方点坐标点的公式为：</p>
<p>$$!\frac{X-X<em>{S}}{Z-Z</em>{S}}=\frac{a<em>{1}x+a</em>{2}y-a<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>$$!\frac{Y-Y<em>{S}}{Z-Z</em>{S}}=\frac{b<em>{1}x+b</em>{2}y-b<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}$$</p>
<p>在垂直形态中，三个角元素严格为0，因次带入之前的矩阵公式得到：</p>
<p>a1=1 a2=0 a3=0 b1=0 b2=1 b3=0 c1=0 c2=0 c3=1</p>
<p>$$!\frac{X-X<em>{S}}{Z-Z</em>{S}}=\frac{x^{0}}{-f}$$</p>
<p>$$!\frac{Y-Y<em>{S}}{Z-Z</em>{S}}=\frac{y^{0}}{-f}$$</p>
<p>其中$$x^{0},y^{0}$$分别表示水平状态的像点坐标。</p>
<p>上两式的外方位角元素不同，而线元素是相同的。因此联立可得<font color="#FF0000">水平纠正的基本公式</font>：</p>
<p>$$!\left{\begin{matrix}x^{0}=-f\frac{a<em>{1}x+a</em>{2}y-a<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}\y^{0}=-f\frac{b<em>{1}x+b</em>{2}y-b<em>{3}f}{c</em>{1}x+c<em>{2}y-c</em>{3}f}\end{matrix}\right.$$</p>
<p>&nbsp;</p>
<div class="PoweredByWebStory" style="margin-top:15px;margin-bottom:10px"><a href="http://sns.juziyue.com/webinvite.php?u=94887" target="_blank" rel="external"></a>&nbsp;今天你<a href="http://sns.juziyue.com/webinvite.php?u=94887" target="_blank" rel="external">菊子曰</a>了么？</div>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-tags">
  
  <span></span> <a href="/tags/检校/">检校</a><a href="/tags/后方交会/">后方交会</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/什么都学一下/">什么都学一下</a>►<a class="article-category-link" href="/categories/什么都学一下/学习log/">学习log</a>
</div>
<div class="article-share" id="share">

  <div data-url="http://ovjaywang.github.io/2015/10/28/后方交会检校(3)--角度、坐标及其应用/" data-title="后方交会检校(3)--角度、坐标及其应用 | ov智商捉急" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2015/10/28/后方交会检校(4)--畸变差矫正/" title="后方交会检校(4)--畸变差矫正">
  <strong>PREVIOUS:</strong><br>
  <span>
  后方交会检校(4)--畸变差矫正</span>
</a>
</div>


<div class="next">
<a href="/2015/10/12/后方交会检校(2)--误差方程及各项系数解求及精度/" title="后方交会检校(2)--误差方程及各项系数解求及精度">
 <strong>NEXT:</strong><br> 
 <span>后方交会检校(2)--误差方程及各项系数解求及精度
</span>
</a>
</div>

</nav>
	<section class="comment">
	<div class="ds-thread"></div>
</section>
</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">Contents</strong>
  
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  <div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/categories/App强推/" title="App强推">App强推<sup>8</sup></a></li>
		
			<li><a href="/categories/tucao/" title="tucao">tucao<sup>1</sup></a></li>
		
			<li><a href="/categories/什么都学一下/" title="什么都学一下">什么都学一下<sup>21</sup></a></li>
		
			<li><a href="/categories/代码狗/" title="代码狗">代码狗<sup>24</sup></a></li>
		
			<li><a href="/categories/什么都学一下/代码狗/" title="代码狗">代码狗<sup>1</sup></a></li>
		
			<li><a href="/categories/代码狗/学习log/" title="学习log">学习log<sup>24</sup></a></li>
		
			<li><a href="/categories/什么都学一下/学习log/" title="学习log">学习log<sup>20</sup></a></li>
		
			<li><a href="/categories/什么都学一下/代码狗/学习log/" title="学习log">学习log<sup>1</sup></a></li>
		
			<li><a href="/categories/槽/" title="槽">槽<sup>39</sup></a></li>
		
			<li><a href="/categories/软件测评/" title="软件测评">软件测评<sup>5</sup></a></li>
		
			<li><a href="/categories/App强推/软文/" title="软文">软文<sup>8</sup></a></li>
		
			<li><a href="/categories/软件测评/软文/" title="软文">软文<sup>5</sup></a></li>
		
		</ul>
</div>

  <div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tags/Android/" title="Android">Android<sup>14</sup></a></li>
		
			<li><a href="/tags/ICP/" title="ICP">ICP<sup>1</sup></a></li>
		
			<li><a href="/tags/MMC/" title="MMC">MMC<sup>1</sup></a></li>
		
			<li><a href="/tags/MME/" title="MME">MME<sup>1</sup></a></li>
		
			<li><a href="/tags/SPark/" title="SPark">SPark<sup>1</sup></a></li>
		
			<li><a href="/tags/bae/" title="bae">bae<sup>1</sup></a></li>
		
			<li><a href="/tags/cmake/" title="cmake">cmake<sup>1</sup></a></li>
		
			<li><a href="/tags/dbscan/" title="dbscan">dbscan<sup>1</sup></a></li>
		
			<li><a href="/tags/demo/" title="demo">demo<sup>1</sup></a></li>
		
			<li><a href="/tags/erdas/" title="erdas">erdas<sup>1</sup></a></li>
		
			<li><a href="/tags/gms/" title="gms">gms<sup>1</sup></a></li>
		
			<li><a href="/tags/hadoop/" title="hadoop">hadoop<sup>3</sup></a></li>
		
			<li><a href="/tags/hello/" title="hello">hello<sup>1</sup></a></li>
		
			<li><a href="/tags/java/" title="java">java<sup>5</sup></a></li>
		
			<li><a href="/tags/jena/" title="jena">jena<sup>2</sup></a></li>
		
			<li><a href="/tags/juddi/" title="juddi">juddi<sup>1</sup></a></li>
		
			<li><a href="/tags/mark/" title="mark">mark<sup>4</sup></a></li>
		
			<li><a href="/tags/mfc/" title="mfc">mfc<sup>1</sup></a></li>
		
			<li><a href="/tags/mysql/" title="mysql">mysql<sup>1</sup></a></li>
		
			<li><a href="/tags/ontology/" title="ontology">ontology<sup>3</sup></a></li>
		
		</ul>
</div>

  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS</a>
</div>

  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Android/" style="font-size: 18.57px">Android</a> <a href="/tags/ICP/" style="font-size: 10px">ICP</a> <a href="/tags/MMC/" style="font-size: 10px">MMC</a> <a href="/tags/MME/" style="font-size: 10px">MME</a> <a href="/tags/SPark/" style="font-size: 10px">SPark</a> <a href="/tags/bae/" style="font-size: 10px">bae</a> <a href="/tags/cmake/" style="font-size: 10px">cmake</a> <a href="/tags/dbscan/" style="font-size: 10px">dbscan</a> <a href="/tags/demo/" style="font-size: 10px">demo</a> <a href="/tags/erdas/" style="font-size: 10px">erdas</a> <a href="/tags/gms/" style="font-size: 10px">gms</a> <a href="/tags/hadoop/" style="font-size: 12.86px">hadoop</a> <a href="/tags/hello/" style="font-size: 10px">hello</a> <a href="/tags/java/" style="font-size: 15.71px">java</a> <a href="/tags/jena/" style="font-size: 11.43px">jena</a> <a href="/tags/juddi/" style="font-size: 10px">juddi</a> <a href="/tags/mark/" style="font-size: 14.29px">mark</a> <a href="/tags/mfc/" style="font-size: 10px">mfc</a> <a href="/tags/mysql/" style="font-size: 10px">mysql</a> <a href="/tags/ontology/" style="font-size: 12.86px">ontology</a> <a href="/tags/opencv/" style="font-size: 10px">opencv</a> <a href="/tags/python/" style="font-size: 11.43px">python</a> <a href="/tags/recommend/" style="font-size: 12.86px">recommend</a> <a href="/tags/sublimetext/" style="font-size: 10px">sublimetext</a> <a href="/tags/test/" style="font-size: 12.86px">test</a> <a href="/tags/后方交会/" style="font-size: 15.71px">后方交会</a> <a href="/tags/吐槽/" style="font-size: 20px">吐槽</a> <a href="/tags/呵呵/" style="font-size: 10px">呵呵</a> <a href="/tags/呵呵哒/" style="font-size: 10px">呵呵哒</a> <a href="/tags/寂寞寂寞就好/" style="font-size: 12.86px">寂寞寂寞就好</a> <a href="/tags/年度总结/" style="font-size: 11.43px">年度总结</a> <a href="/tags/我失恋了/" style="font-size: 10px">我失恋了</a> <a href="/tags/控制台/" style="font-size: 10px">控制台</a> <a href="/tags/无线传输/" style="font-size: 10px">无线传输</a> <a href="/tags/本体/" style="font-size: 11.43px">本体</a> <a href="/tags/本体论/" style="font-size: 11.43px">本体论</a> <a href="/tags/机器学习/" style="font-size: 10px">机器学习</a> <a href="/tags/梯子/" style="font-size: 10px">梯子</a> <a href="/tags/检校/" style="font-size: 17.14px">检校</a> <a href="/tags/测评/" style="font-size: 11.43px">测评</a> <a href="/tags/游记/" style="font-size: 10px">游记</a> <a href="/tags/点云/" style="font-size: 10px">点云</a> <a href="/tags/热点/" style="font-size: 10px">热点</a> <a href="/tags/电影/" style="font-size: 12.86px">电影</a> <a href="/tags/算法/" style="font-size: 10px">算法</a> <a href="/tags/精度/" style="font-size: 10px">精度</a> <a href="/tags/翔/" style="font-size: 10px">翔</a> <a href="/tags/考研/" style="font-size: 15.71px">考研</a> <a href="/tags/航空摄影测量/" style="font-size: 10px">航空摄影测量</a> <a href="/tags/装机/" style="font-size: 10px">装机</a> <a href="/tags/计算机视觉/" style="font-size: 10px">计算机视觉</a> <a href="/tags/语义网/" style="font-size: 11.43px">语义网</a> <a href="/tags/足球/" style="font-size: 10px">足球</a> <a href="/tags/静态ip/" style="font-size: 10px">静态ip</a> <a href="/tags/音乐/" style="font-size: 10px">音乐</a> <a href="/tags/马克/" style="font-size: 15.71px">马克</a>
    </div>
  </div>

</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 这里是ov的站 <br>
			多多留言交流技术问题阿</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/302060345" target="_blank" title="weibo"></a>
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2016 
		
		<a href="http://ovjaywang.github.io" target="_blank" title="Jay Wang">Jay Wang</a>
		
		</p>
</div></footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"dooby"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
<!-- End: Injected MathJax --><!-- hexo-inject:end -->
  </body>
